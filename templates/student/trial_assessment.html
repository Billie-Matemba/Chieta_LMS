{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHIETA Online Quiz System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3C1B50;
            --secondary-color: #8f6620;
            --correct-color: #4CAF50;
            --incorrect-color: #F44336;
            --warning-color: #FF9800;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #333333;
            --text-light: #666666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark-gray);
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .dashboard-title {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .dashboard-subtitle {
            color: var(--text-light);
            font-size: 18px;
        }
        
        .quiz-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .quiz-card {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .quiz-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .quiz-card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .quiz-card-category {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            background-color: rgba(60, 27, 80, 0.2);
            color: var(--primary-color);
        }
        
        .quiz-card-body {
            margin-bottom: 20px;
        }
        
        .quiz-card-description {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .quiz-card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-light);
        }
        
        .quiz-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .quiz-card-btn {
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            background-color: var(--primary-color);
            color: white;
        }
        
        .quiz-card-btn:hover {
            background-color: #2a1238;
        }
        
        /* Quiz Container Styles */
        .quiz-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: none;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .quiz-title {
            font-size: 24px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            background-color: var(--light-gray);
            padding: 10px 15px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .timer-icon {
            margin-right: 8px;
            color: var(--warning-color);
        }
        
        .timer {
            color: var(--primary-color);
        }
        
        .warning {
            color: var(--warning-color);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .quiz-body {
            display: flex;
            gap: 20px;
        }
        
        .question-navigation {
            width: 250px;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .nav-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        
        .question-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .question-btn:hover {
            background-color: var(--medium-gray);
        }
        
        .question-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .question-btn.answered {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
        }
        
        .question-btn.marked {
            position: relative;
        }
        
        .question-btn.marked::after {
            content: "!";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--warning-color);
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-content {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .question-number {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .question-type {
            background-color: var(--light-gray);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        /* Multiple Choice Options */
        .options-list {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .option-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: var(--light-gray);
            border-radius: 6px;
            border: 1px solid var(--medium-gray);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-item:hover {
            background-color: #e9e9e9;
        }
        
        .option-item.selected {
            border-color: var(--primary-color);
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        /* True/False Options */
        .true-false-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .true-false-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .true-false-btn:hover {
            background-color: #e9e9e9;
        }
        
        .true-false-btn.selected {
            border-color: var(--primary-color);
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        /* Matching Questions */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .matching-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .matching-item {
            padding: 12px;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            cursor: move;
            text-align: center;
        }
        
        .matched-pair {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .matched-item {
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: 6px;
            flex: 1;
            text-align: center;
        }
        
        .match-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .match-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        /* Fill in the Blank */
        .fill-blank-container {
            margin-bottom: 20px;
        }
        
        .fill-blank-input {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            margin: 0 5px;
            width: 200px;
        }
        
        /* Essay Questions */
        .essay-container {
            margin-bottom: 20px;
        }
        
        .essay-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
        }
        
        .word-count {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
            text-align: right;
        }
        
        /* Case Study */
        .case-study-container {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .case-study-text {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        /* Chart Questions - Made smaller */
        .chart-container {
            margin: 15px 0;
            max-width: 350px;
            max-height: 250px;
        }
        
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .chart-box {
            flex: 1;
            min-width: 250px;
            height: 200px;
        }
        
        /* Matched pairs container */
        .matched-pairs-container {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            padding: 5px;
        }
        
        /* Question Navigation */
        .question-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--medium-gray);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-outline {
            background: white;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2a1238;
        }
        
        .mark-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .mark-btn:hover {
            background-color: #e68a00;
        }
        
        .submit-btn {
            background-color: var(--correct-color);
            color: white;
        }
        
        .submit-btn:hover {
            background-color: #3d8b40;
        }
        
        /* Quiz Rules Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-container {
            background-color: white;
            border-radius: 8px;
            width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .rules-list {
            list-style-type: none;
            margin-bottom: 20px;
        }
        
        .rules-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: flex-start;
        }
        
        .rules-list li i {
            margin-right: 10px;
            color: var(--secondary-color);
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--medium-gray);
            text-align: right;
        }
        
        /* Result chart container */
        .result-chart-container {
            max-width: 300px;
            max-height: 200px;
            margin: 0 auto 20px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .quiz-body {
                flex-direction: column;
            }
            
            .question-navigation {
                width: 100%;
                order: 2;
                margin-top: 20px;
            }
            
            .quiz-card-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .matching-container {
                grid-template-columns: 1fr;
            }
            
            .question-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .chart-box {
                min-width: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .timer-container {
                margin-top: 10px;
            }
            
            .question-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .true-false-options {
                flex-direction: column;
            }
            
            .matched-pair {
                flex-direction: column;
            }
            
            .dashboard-title {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard View -->
    <div class="dashboard-container" id="dashboard-view">
        <div class="dashboard-header">
            <h1 class="dashboard-title">CHIETA Online Quiz System</h1>
            <p class="dashboard-subtitle">Test your knowledge for different CHIETA parts and qualifications</p>
        </div>
        
        <div class="quiz-card-container">
            <!-- Part Qualification Quizzes -->
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Chemical Manufacturing Part 1</h2>
                    <span class="quiz-card-category">Part Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        This quiz covers fundamental principles of chemical manufacturing including safety procedures, 
                        equipment operation, and basic process knowledge for Part 1 qualification.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 20 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-flask"></i> Chemical Manufacturing</span>
                    <button class="quiz-card-btn" onclick="showQuiz('chem-manufacturing-part1')">
                        Take Quiz
                    </button>
                </div>
            </div>
            
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Plastics Manufacturing Part 2</h2>
                    <span class="quiz-card-category">Part Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        Test your knowledge of plastics manufacturing processes, material properties, 
                        and quality control for Part 2 qualification.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 20 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-cubes"></i> Plastics Manufacturing</span>
                    <button class="quiz-card-btn" onclick="showQuiz('plastics-part2')">
                        Take Quiz
                    </button>
                </div>
            </div>
            
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Pharmaceuticals Part 3</h2>
                    <span class="quiz-card-category">Part Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        Quiz covering pharmaceutical manufacturing processes, GMP regulations, and quality assurance 
                        for Part 3 qualification.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 20 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-pills"></i> Pharmaceuticals</span>
                    <button class="quiz-card-btn" onclick="showQuiz('pharma-part3')">
                        Take Quiz
                    </button>
                </div>
            </div>
            
            <!-- Full Qualification Quizzes -->
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Chemical Process Technician</h2>
                    <span class="quiz-card-category">Full Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        Comprehensive quiz covering all aspects of the Chemical Process Technician qualification 
                        including process control, troubleshooting, and safety management.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 30 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-industry"></i> NQF Level 5</span>
                    <button class="quiz-card-btn" onclick="showQuiz('chem-process-tech')">
                        Take Quiz
                    </button>
                </div>
            </div>
            
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Plastics Manufacturing Technician</h2>
                    <span class="quiz-card-category">Full Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        Quiz covering the full Plastics Manufacturing Technician qualification including 
                        injection molding, extrusion processes, and quality control systems.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 30 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-cube"></i> NQF Level 4</span>
                    <button class="quiz-card-btn" onclick="showQuiz('plastics-tech')">
                        Take Quiz
                    </button>
                </div>
            </div>
            
            <div class="quiz-card">
                <div class="quiz-card-header">
                    <h2 class="quiz-card-title">Pharmaceutical Manufacturing</h2>
                    <span class="quiz-card-category">Full Qualification</span>
                </div>
                <div class="quiz-card-body">
                    <p class="quiz-card-description">
                        Comprehensive quiz for the Pharmaceutical Manufacturing qualification covering 
                        formulation, packaging, validation, and regulatory compliance.
                    </p>
                    <div class="quiz-card-meta">
                        <span><i class="far fa-clock"></i> 30 minutes</span>
                        <span><i class="far fa-question-circle"></i> 10 questions</span>
                    </div>
                </div>
                <div class="quiz-card-footer">
                    <span><i class="fas fa-prescription-bottle-alt"></i> NQF Level 5</span>
                    <button class="quiz-card-btn" onclick="showQuiz('pharma-manufacturing')">
                        Take Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quiz View -->
    <div class="quiz-container" id="quiz-view">
        <!-- Quiz Header with Timer -->
        <div class="quiz-header">
            <div class="quiz-title" id="quiz-title">CHIETA Quiz</div>
            <div class="timer-container">
                <i class="fas fa-clock timer-icon"></i>
                <div class="timer" id="quiz-timer">20:00</div>
            </div>
        </div>
        
        <!-- Quiz Body -->
        <div class="quiz-body">
            <!-- Question Navigation Panel -->
            <div class="question-navigation">
                <div class="nav-title">
                    <span>Questions</span>
                    <span id="answered-count">0/10</span>
                </div>
                <div class="question-grid" id="question-grid">
                    <!-- Questions will be added dynamically -->
                </div>
                <button class="btn btn-outline" style="width: 100%; margin-top: 15px;" onclick="returnToDashboard()">
                    <i class="fas fa-arrow-left"></i> Return to Dashboard
                </button>
            </div>
            
            <!-- Question Content -->
            <div class="question-content" id="question-content">
                <!-- Question will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Quiz Rules Modal -->
    <div class="modal-overlay" id="rules-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">Quiz Instructions</div>
                <button class="modal-close" onclick="startQuiz()">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 15px; color: var(--primary-color);">Please read the following instructions carefully:</h3>
                
                <ul class="rules-list">
                    <li>
                        <i class="fas fa-clock"></i>
                        <div>
                            <strong>Time Limit:</strong> You have 20 minutes to complete this quiz (30 minutes for full qualifications).
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-question-circle"></i>
                        <div>
                            <strong>Question Navigation:</strong> You can attempt questions in any order. Use the question navigation panel to jump between questions.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-flag"></i>
                        <div>
                            <strong>Marking Questions:</strong> You can mark questions for review and come back to them later.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Answering Questions:</strong> For multiple choice questions, select one answer. For matching questions, drag and drop items to match them.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-chart-pie"></i>
                        <div>
                            <strong>Chart Questions:</strong> Some questions may require you to interpret data from various chart types.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Auto-Submission:</strong> The quiz will automatically submit when time expires.
                        </div>
                    </li>
                </ul>
                
                <div style="background-color: rgba(143, 102, 32, 0.1); padding: 15px; border-radius: 6px; border-left: 4px solid var(--secondary-color);">
                    <h4 style="color: var(--secondary-color); margin-bottom: 10px;">Important Note:</h4>
                    <p>Once you start the quiz, you cannot pause the timer. All answers are final after submission. Good luck!</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="startQuiz()">I Understand - Start Quiz</button>
            </div>
        </div>
    </div>
    
    <script>
        // Quiz data with 10 questions for each CHIETA part and full qualification
        const quizzes = {
            // Part Qualification Quizzes
            'chem-manufacturing-part1': {
                title: "Chemical Manufacturing Part 1 Quiz",
                duration: 20, // in minutes
                questions: createChemManufacturingPart1Quiz()
            },
            'plastics-part2': {
                title: "Plastics Manufacturing Part 2 Quiz",
                duration: 20,
                questions: createPlasticsPart2Quiz()
            },
            'pharma-part3': {
                title: "Pharmaceuticals Part 3 Quiz",
                duration: 20,
                questions: createPharmaPart3Quiz()
            },
            
            // Full Qualification Quizzes
            'chem-process-tech': {
                title: "Chemical Process Technician Qualification Quiz",
                duration: 30,
                questions: createChemProcessTechQuiz()
            },
            'plastics-tech': {
                title: "Plastics Manufacturing Technician Qualification Quiz",
                duration: 30,
                questions: createPlasticsTechQuiz()
            },
            'pharma-manufacturing': {
                title: "Pharmaceutical Manufacturing Qualification Quiz",
                duration: 30,
                questions: createPharmaManufacturingQuiz()
            }
        };
        
        function createChemManufacturingPart1Quiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "What is the primary purpose of a Material Safety Data Sheet (MSDS) in chemical manufacturing?",
                    options: [
                        "To provide detailed instructions for equipment operation",
                        "To list the hazardous properties of chemicals and safety precautions",
                        "To document production quantities",
                        "To track employee work hours"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "Personal Protective Equipment (PPE) is only required when handling highly toxic chemicals.",
                    correctAnswer: false
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following chemical manufacturing equipment to its primary function:",
                    leftItems: ["Reactor", "Distillation Column", "Centrifuge", "Heat Exchanger"],
                    rightItems: [
                        "Where chemical reactions occur",
                        "Separates components based on boiling points",
                        "Separates solids from liquids using rotation",
                        "Transfers heat between fluids"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ system is designed to prevent the release of hazardous chemicals during overpressure situations.",
                    correctAnswer: "pressure relief"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what was the most likely root cause of the incident?",
                    caseText: "A chemical operator was injured when a valve unexpectedly released hot steam. The investigation revealed that the valve was not properly locked out during maintenance, and the operator bypassed the safety interlock system to restart the equipment.",
                    options: [
                        "Faulty valve design",
                        "Inadequate lockout/tagout procedures",
                        "Lack of personal protective equipment",
                        "Insufficient operator training"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 6,
                    type: "chart-pie",
                    question: "Based on the pie chart showing chemical plant accidents by cause, which factor accounts for the largest percentage of incidents?",
                    chartData: {
                        labels: ['Human Error', 'Equipment Failure', 'Procedural Issues', 'External Factors'],
                        datasets: [{
                            data: [45, 30, 20, 5],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 0 // Human Error
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a standard operating procedure in chemical manufacturing?",
                    options: [
                        "Regular equipment calibration",
                        "Bypassing safety systems to increase production",
                        "Periodic safety audits",
                        "Emergency shutdown drills"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "All chemical containers must be labeled with their contents and hazards, even if they are only used temporarily.",
                    correctAnswer: true
                },
                {
                    id: 9,
                    type: "chart-bar",
                    question: "Based on the bar chart showing production output by shift, which shift had the highest output with the fewest quality incidents?",
                    chartData: {
                        labels: ['Morning', 'Afternoon', 'Night'],
                        datasets: [
                            {
                                label: 'Output (tons)',
                                data: [120, 150, 130],
                                backgroundColor: 'rgba(60, 27, 80, 0.7)'
                            },
                            {
                                label: 'Quality Incidents',
                                data: [5, 3, 8],
                                backgroundColor: 'rgba(244, 67, 54, 0.7)'
                            }
                        ]
                    },
                    correctAnswer: 1 // Afternoon
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Explain why proper waste disposal is critical in chemical manufacturing. Provide at least two examples of proper waste handling procedures.",
                    minWords: 50
                }
            ];
        }
        
        function createPlasticsPart2Quiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a common plastic manufacturing process?",
                    options: [
                        "Injection molding",
                        "Blow molding",
                        "Thermal cracking",
                        "Extrusion"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "Polyethylene terephthalate (PET) is commonly used for beverage bottles because it provides a good barrier against carbon dioxide.",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the plastic resin identification codes to their corresponding materials:",
                    leftItems: ["1 - PETE", "2 - HDPE", "3 - PVC", "4 - LDPE"],
                    rightItems: [
                        "Polyethylene terephthalate",
                        "High-density polyethylene",
                        "Polyvinyl chloride",
                        "Low-density polyethylene"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The process of heating plastic pellets until they melt into a viscous liquid is called __________.",
                    correctAnswer: "plasticization"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what adjustment should be made to reduce the warping of plastic parts?",
                    caseText: "A plastic injection molding process is producing parts with significant warping. The mold temperature is currently set at 60Â°C, the injection pressure at 800 bar, and the cooling time at 15 seconds. The material is ABS plastic.",
                    options: [
                        "Increase mold temperature",
                        "Decrease injection pressure",
                        "Increase cooling time",
                        "All of the above"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 6,
                    type: "chart-line",
                    question: "Based on the line chart showing scrap rates over time, during which month did the scrap rate peak?",
                    chartData: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Scrap Rate (%)',
                            data: [2.5, 3.1, 4.8, 3.5, 2.9, 2.7],
                            borderColor: 'rgba(60, 27, 80, 1)',
                            backgroundColor: 'rgba(60, 27, 80, 0.1)'
                        }]
                    },
                    correctAnswer: 2 // March
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which additive is commonly used in plastics to make them more flexible?",
                    options: [
                        "Pigments",
                        "Plasticizers",
                        "Flame retardants",
                        "Antioxidants"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "Thermosetting plastics can be reheated and reshaped multiple times.",
                    correctAnswer: false
                },
                {
                    id: 9,
                    type: "chart-radar",
                    question: "Based on the radar chart comparing three plastic materials, which material has the best combination of strength and chemical resistance but the poorest UV stability?",
                    chartData: {
                        labels: ['Strength', 'Chemical Resistance', 'UV Stability', 'Cost', 'Processability'],
                        datasets: [
                            {
                                label: 'Material A',
                                data: [70, 80, 60, 50, 90],
                                backgroundColor: 'rgba(60, 27, 80, 0.2)'
                            },
                            {
                                label: 'Material B',
                                data: [90, 85, 40, 70, 75],
                                backgroundColor: 'rgba(143, 102, 32, 0.2)'
                            },
                            {
                                label: 'Material C',
                                data: [80, 70, 85, 60, 80],
                                backgroundColor: 'rgba(76, 175, 80, 0.2)'
                            }
                        ]
                    },
                    correctAnswer: 1 // Material B
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Describe the importance of proper drying procedures for plastic resins before processing. What problems can occur if resins are not properly dried?",
                    minWords: 60
                }
            ];
        }
        
        function createPharmaPart3Quiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "What does GMP stand for in pharmaceutical manufacturing?",
                    options: [
                        "Good Manufacturing Practice",
                        "General Medical Protocol",
                        "Guaranteed Medication Purity",
                        "Global Medicine Production"
                    ],
                    correctAnswer: 0
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "In cleanroom classifications, a lower number indicates a cleaner environment (e.g., Class 100 is cleaner than Class 10,000).",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following pharmaceutical dosage forms to their descriptions:",
                    leftItems: ["Tablet", "Capsule", "Syrup", "Ointment"],
                    rightItems: [
                        "Solid dosage form compressed from powders",
                        "Gelatin shell containing medication",
                        "Liquid medication with dissolved or suspended drugs",
                        "Semi-solid preparation for external application"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ is a document that provides a complete history of a batch of pharmaceutical product from raw materials to finished product.",
                    correctAnswer: "batch record"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what was the most likely cause of the cross-contamination?",
                    caseText: "A pharmaceutical plant discovered Product A in samples of Product B. Investigation revealed that both products were manufactured on the same equipment, but cleaning verification showed no residues after cleaning. Further review showed that the same scoops were used for both products during sampling.",
                    options: [
                        "Inadequate equipment cleaning",
                        "Improper sampling procedures",
                        "Faulty analytical testing",
                        "Incorrect labeling"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 6,
                    type: "chart-bar",
                    question: "Based on the bar chart showing deviation types in a pharmaceutical plant, which type of deviation occurs most frequently?",
                    chartData: {
                        labels: ['Equipment', 'Documentation', 'Environmental', 'Personnel'],
                        datasets: [{
                            label: 'Deviations per Quarter',
                            data: [12, 18, 8, 5],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 1 // Documentation
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a required element of pharmaceutical documentation?",
                    options: [
                        "Batch manufacturing record",
                        "Standard operating procedures",
                        "Employee personal diaries",
                        "Quality control test results"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "All pharmaceutical manufacturing personnel must undergo GMP training annually.",
                    correctAnswer: true
                },
                {
                    id: 9,
                    type: "chart-pie",
                    question: "Based on the pie chart showing reasons for product rejections, what percentage of rejections are due to incorrect labeling?",
                    chartData: {
                        labels: ['Contamination', 'Potency', 'Appearance', 'Labeling', 'Packaging'],
                        datasets: [{
                            data: [35, 25, 15, 10, 15],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)',
                                'rgba(255, 152, 0, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 3 // 10%
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Explain why temperature and humidity control is critical in pharmaceutical manufacturing. Provide two examples of products that might be particularly sensitive to environmental conditions.",
                    minWords: 70
                }
            ];
        }
        
        function createChemProcessTechQuiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a responsibility of a Chemical Process Technician?",
                    options: [
                        "Monitoring process parameters",
                        "Performing routine equipment maintenance",
                        "Developing new chemical formulas",
                        "Recording production data"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "A PID controller uses proportional, integral, and derivative actions to maintain process variables at set points.",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following process variables to their typical units of measurement:",
                    leftItems: ["Flow rate", "Pressure", "Temperature", "Level"],
                    rightItems: [
                        "mÂ³/h or kg/h",
                        "kPa or bar",
                        "Â°C or K",
                        "% or m"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ system is designed to safely vent excess pressure from process equipment.",
                    correctAnswer: "pressure relief"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what should the operator do first when noticing the rising reactor temperature?",
                    caseText: "An operator notices the temperature in a batch reactor is rising above the set point. The cooling water valve is fully open, but the temperature continues to climb. The reaction is exothermic and the pressure is beginning to increase.",
                    options: [
                        "Increase the cooling water flow rate",
                        "Initiate the emergency shutdown procedure",
                        "Reduce the feed rate of reactants",
                        "Continue monitoring to see if it stabilizes"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 6,
                    type: "chart-line",
                    question: "Based on the trend chart showing reactor temperature over an 8-hour shift, at what time did the temperature first exceed the upper control limit?",
                    chartData: {
                        labels: ['00:00', '02:00', '04:00', '06:00', '08:00'],
                        datasets: [{
                            label: 'Temperature (Â°C)',
                            data: [120, 125, 130, 135, 140],
                            borderColor: 'rgba(244, 67, 54, 1)',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)'
                        }]
                    },
                    correctAnswer: 3 // 06:00
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a standard part of a lockout/tagout procedure?",
                    options: [
                        "Notify affected employees",
                        "Identify all energy sources",
                        "Test the equipment to verify isolation",
                        "Have a second operator verify the lockout"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "A higher Reynolds number indicates more turbulent flow in a pipe.",
                    correctAnswer: true
                },
                {
                    id: 9,
                    type: "chart-bar",
                    question: "Based on the stacked bar chart showing production by shift, which shift had the highest output with the fewest quality incidents?",
                    chartData: {
                        labels: ['A', 'B', 'C'],
                        datasets: [
                            {
                                label: 'Good Product (tons)',
                                data: [45, 50, 40],
                                backgroundColor: 'rgba(76, 175, 80, 0.7)'
                            },
                            {
                                label: 'Rejected Product (tons)',
                                data: [5, 3, 8],
                                backgroundColor: 'rgba(244, 67, 54, 0.7)'
                            }
                        ]
                    },
                    correctAnswer: 1 // Shift B
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Describe the importance of standard operating procedures (SOPs) in chemical process operations. What are two key elements that should be included in every SOP?",
                    minWords: 80
                }
            ];
        }
        
        function createPlasticsTechQuiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a typical responsibility of a Plastics Manufacturing Technician?",
                    options: [
                        "Setting up injection molding machines",
                        "Monitoring extrusion processes",
                        "Developing new polymer formulations",
                        "Performing quality checks"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "The screw speed in an extruder directly affects the output rate and melt temperature.",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following plastic defects to their most likely causes:",
                    leftItems: ["Splay marks", "Short shots", "Warping", "Flash"],
                    rightItems: [
                        "Moisture in the material",
                        "Insufficient material or pressure",
                        "Uneven cooling",
                        "Excessive injection pressure"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ test measures the melt flow rate of a plastic material, which indicates its viscosity.",
                    correctAnswer: "melt flow index"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what adjustment would most likely reduce the occurrence of sink marks?",
                    caseText: "An injection molding process is producing parts with visible sink marks near thick sections. The current parameters are: melt temperature 220Â°C, mold temperature 60Â°C, packing pressure 800 bar, cooling time 20 seconds.",
                    options: [
                        "Increase melt temperature",
                        "Increase packing pressure",
                        "Decrease cooling time",
                        "All of the above"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 6,
                    type: "chart-line",
                    question: "Based on the trend chart showing scrap rates over a week, on which day did the scrap rate peak?",
                    chartData: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                        datasets: [{
                            label: 'Scrap Rate (%)',
                            data: [2.1, 2.5, 3.8, 2.9, 2.3],
                            borderColor: 'rgba(60, 27, 80, 1)',
                            backgroundColor: 'rgba(60, 27, 80, 0.1)'
                        }]
                    },
                    correctAnswer: 2 // Wednesday
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a common plastic additive?",
                    options: [
                        "Plasticizers",
                        "Stabilizers",
                        "Catalysts",
                        "Colorants"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "Regrind material (recycled plastic) can always be used in the same proportion as virgin material without affecting product quality.",
                    correctAnswer: false
                },
                {
                    id: 9,
                    type: "chart-radar",
                    question: "Based on the radar chart comparing three plastic materials, which material has the best combination of strength and impact resistance but the poorest UV stability?",
                    chartData: {
                        labels: ['Strength', 'Impact Resistance', 'UV Stability', 'Cost', 'Processability'],
                        datasets: [
                            {
                                label: 'Material X',
                                data: [70, 80, 60, 50, 90],
                                backgroundColor: 'rgba(60, 27, 80, 0.2)'
                            },
                            {
                                label: 'Material Y',
                                data: [90, 85, 40, 70, 75],
                                backgroundColor: 'rgba(143, 102, 32, 0.2)'
                            },
                            {
                                label: 'Material Z',
                                data: [80, 70, 85, 60, 80],
                                backgroundColor: 'rgba(76, 175, 80, 0.2)'
                            }
                        ]
                    },
                    correctAnswer: 1 // Material Y
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Explain the importance of proper material drying in plastic processing. What problems can occur if materials are not dried properly?",
                    minWords: 70
                }
            ];
        }
        
        function createPharmaManufacturingQuiz() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a key principle of Good Manufacturing Practice (GMP)?",
                    options: [
                        "Documenting all activities",
                        "Maintaining clean facilities",
                        "Using the cheapest available materials",
                        "Validating processes"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "In pharmaceutical manufacturing, all deviations from standard procedures must be documented and investigated.",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following pharmaceutical dosage forms to their primary manufacturing processes:",
                    leftItems: ["Tablets", "Capsules", "Sterile Injectables", "Ointments"],
                    rightItems: [
                        "Compression",
                        "Filling gelatin shells",
                        "Aseptic processing",
                        "Mixing and milling"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ is a systematic approach to identifying and controlling potential risks to product quality.",
                    correctAnswer: "quality risk management"
                },
                {
                    id: 5,
                    type: "case-study",
                    question: "Based on the case study below, what was the most likely root cause of the failed dissolution test?",
                    caseText: "A batch of tablets failed dissolution testing. Investigation revealed that the granulation step had shorter mixing time than specified, the compression force was at the low end of the range, and the coating was slightly thicker than normal.",
                    options: [
                        "Insufficient granulation mixing",
                        "Low compression force",
                        "Excessive coating thickness",
                        "Combination of all factors"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 6,
                    type: "chart-bar",
                    question: "Based on the bar chart showing deviation types in a pharmaceutical plant, which type of deviation occurs most frequently?",
                    chartData: {
                        labels: ['Equipment', 'Documentation', 'Environmental', 'Personnel'],
                        datasets: [{
                            label: 'Deviations per Quarter',
                            data: [15, 22, 10, 8],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 1 // Documentation
                },
                {
                    id: 7,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a required element of pharmaceutical documentation?",
                    options: [
                        "Batch manufacturing record",
                        "Standard operating procedures",
                        "Employee personal notes",
                        "Quality control test results"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 8,
                    type: "true-false",
                    question: "All pharmaceutical manufacturing personnel must undergo GMP training before starting work and periodically thereafter.",
                    correctAnswer: true
                },
                {
                    id: 9,
                    type: "chart-pie",
                    question: "Based on the pie chart showing reasons for product rejections, what percentage of rejections are due to incorrect labeling?",
                    chartData: {
                        labels: ['Contamination', 'Potency', 'Appearance', 'Labeling', 'Packaging'],
                        datasets: [{
                            data: [30, 25, 20, 15, 10],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)',
                                'rgba(255, 152, 0, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 3 // 15%
                },
                {
                    id: 10,
                    type: "essay",
                    question: "Explain why environmental monitoring is critical in pharmaceutical manufacturing. Provide two examples of areas that require special environmental controls.",
                    minWords: 90
                }
            ];
        }
        
        // Current quiz state
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let markedQuestions = [];
        let answeredCount = 0;
        let quizStarted = false;
        let timeLeft = 0;
        let timerInterval;
        let charts = [];
        
        // DOM elements
        const dashboardView = document.getElementById('dashboard-view');
        const quizView = document.getElementById('quiz-view');
        const questionContent = document.getElementById('question-content');
        const questionGrid = document.getElementById('question-grid');
        const answeredCountEl = document.getElementById('answered-count');
        const quizTimer = document.getElementById('quiz-timer');
        const quizTitleEl = document.getElementById('quiz-title');
        const rulesModal = document.getElementById('rules-modal');
        
        // Initialize the quiz system
        function initQuizSystem() {
            // Hide quiz view by default
            quizView.style.display = 'none';
            rulesModal.style.display = 'none';
        }
        
        // Show quiz view
        function showQuiz(quizId) {
            currentQuiz = quizId;
            currentQuestionIndex = 0;
            userAnswers = Array(quizzes[quizId].questions.length).fill(null);
            markedQuestions = Array(quizzes[quizId].questions.length).fill(false);
            answeredCount = 0;
            timeLeft = quizzes[quizId].duration * 60;
            
            // Update UI
            dashboardView.style.display = 'none';
            quizView.style.display = 'block';
            quizTitleEl.textContent = quizzes[quizId].title;
            
            // Create question navigation buttons
            questionGrid.innerHTML = '';
            quizzes[quizId].questions.forEach((q, index) => {
                const btn = document.createElement('button');
                btn.className = 'question-btn';
                btn.textContent = q.id;
                btn.onclick = () => navigateToQuestion(index);
                questionGrid.appendChild(btn);
            });
            
            // Show rules modal
            rulesModal.style.display = 'flex';
        }
        
        // Start the quiz
        function startQuiz() {
            rulesModal.style.display = 'none';
            quizStarted = true;
            
            // Start timer
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Initial update
            
            // Load first question
            loadQuestion(currentQuestionIndex);
        }
        
        // Return to dashboard
        function returnToDashboard() {
            if (confirm('Are you sure you want to return to the dashboard? Your progress will not be saved.')) {
                clearInterval(timerInterval);
                dashboardView.style.display = 'block';
                quizView.style.display = 'none';
                quizStarted = false;
            }
        }
        
        // Update the timer
        function updateTimer() {
            timeLeft--;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitQuiz();
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            
            quizTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning class when time is running low
            if (timeLeft <= 300) { // 5 minutes
                quizTimer.classList.add('warning');
            }
        }
        
        // Navigate to a specific question
        function navigateToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion(index);
        }
        
        // Load a question
        function loadQuestion(index) {
            const quiz = quizzes[currentQuiz];
            const question = quiz.questions[index];
            
            // Update active question in navigation
            updateQuestionNavigation();
            
            let questionHTML = `
                <div class="question-header">
                    <div class="question-number">Question ${question.id}</div>
                    <div class="question-type">${formatQuestionType(question.type)}</div>
                </div>
                
                <div class="question-text">${question.question}</div>
            `;
            
            // Add question content based on type
            switch (question.type) {
                case 'multiple-choice':
                    questionHTML += `
                        <ul class="options-list">
                            ${question.options.map((option, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${option}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'true-false':
                    questionHTML += `
                        <div class="true-false-options">
                            <div class="true-false-btn ${userAnswers[index] === true ? 'selected' : ''}" 
                                onclick="selectAnswer(true)">
                                True
                            </div>
                            <div class="true-false-btn ${userAnswers[index] === false ? 'selected' : ''}" 
                                onclick="selectAnswer(false)">
                                False
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'matching':
                    // Improved matching question interface
                    questionHTML += `
                        <div class="matching-container">
                            <div class="matching-column">
                                <h4>Items</h4>
                                ${question.leftItems.map((item, i) => `
                                    <div class="matching-item" id="left-${i}" draggable="true" ondragstart="drag(event)">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                            <div class="matching-column">
                                <h4>Matches</h4>
                                ${question.rightItems.map((item, i) => `
                                    <div class="matching-item" id="right-${i}" ondrop="drop(event, ${i})" ondragover="allowDrop(event)">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <h4>Your Matches</h4>
                            <div class="matched-pairs-container" id="matched-pairs-container">
                                ${userAnswers[index] ? userAnswers[index].map(pair => `
                                    <div class="matched-pair" id="pair-${pair[0]}-${pair[1]}">
                                        <div class="matched-item">${question.leftItems[pair[0]]}</div>
                                        <div class="match-controls">
                                            <button class="match-btn" onclick="removeMatch(${index}, ${pair[0]}, ${pair[1]})">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="matched-item">${question.rightItems[pair[1]]}</div>
                                    </div>
                                `).join('') : ''}
                            </div>
                        </div>
                        <div style="font-size: 14px; color: var(--text-light); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> Drag items from the left column to the right column to make matches.
                        </div>
                    `;
                    break;
                    
                case 'fill-blank':
                    questionHTML += `
                        <div class="fill-blank-container">
                            <input type="text" class="fill-blank-input" id="fill-answer" 
                                value="${userAnswers[index] || ''}" 
                                placeholder="Type your answer here" 
                                onchange="selectAnswer(this.value)">
                        </div>
                    `;
                    break;
                    
                case 'essay':
                    const essayAnswer = userAnswers[index] || '';
                    const wordCount = essayAnswer ? essayAnswer.split(/\s+/).filter(word => word.length > 0).length : 0;
                    questionHTML += `
                        <div class="essay-container">
                            <textarea class="essay-textarea" id="essay-answer" 
                                placeholder="Type your response here (minimum ${question.minWords} words)..."
                                oninput="updateEssayWordCount(${index}, this)">${essayAnswer}</textarea>
                            <div class="word-count">Words: ${wordCount} (Minimum: ${question.minWords})</div>
                        </div>
                    `;
                    break;
                    
                case 'case-study':
                    questionHTML += `
                        <div class="case-study-container">
                            <div class="case-study-text">${question.caseText}</div>
                        </div>
                        <ul class="options-list" style="margin-top: 15px;">
                            ${question.options.map((option, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${option}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'chart-radar':
                case 'chart-pie':
                case 'chart-line':
                case 'chart-bar':
                case 'chart-doughnut':
                case 'chart-polar':
                    questionHTML += `
                        <div class="chart-row">
                            <div class="chart-box">
                                <canvas id="question-chart"></canvas>
                            </div>
                        </div>
                        <ul class="options-list" style="margin-top: 15px;">
                            ${question.chartData.labels.map((label, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${label}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'calculation':
                    questionHTML += `
                        <div class="fill-blank-container">
                            <input type="text" class="fill-blank-input" id="calc-answer" 
                                value="${userAnswers[index] || ''}" 
                                placeholder="Enter your calculated answer" 
                                onchange="selectAnswer(this.value)">
                            <div style="font-size: 14px; color: var(--text-light); margin-top: 10px;">
                                <i class="fas fa-info-circle"></i> Enter numerical value only, without units.
                            </div>
                        </div>
                    `;
                    break;
            }
            
            // Add navigation buttons
            questionHTML += `
                <div class="question-actions">
                    <div>
                        ${index > 0 ? `
                            <button class="btn btn-outline" onclick="navigateToQuestion(${index - 1})">
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                        ` : ''}
                    </div>
                    
                    <div>
                        <button class="btn mark-btn" onclick="toggleMarkQuestion()">
                            ${markedQuestions[index] ? '<i class="fas fa-flag"></i> Unmark' : '<i class="far fa-flag"></i> Mark'}
                        </button>
                        
                        ${index < quizzes[currentQuiz].questions.length - 1 ? `
                            <button class="btn btn-primary" onclick="navigateToQuestion(${index + 1})">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        ` : `
                            <button class="btn submit-btn" onclick="confirmSubmit()">
                                <i class="fas fa-paper-plane"></i> Submit Quiz
                            </button>
                        `}
                    </div>
                </div>
            `;
            
            questionContent.innerHTML = questionHTML;
            
            // Render chart if this is a chart question
            if (question.type.includes('chart')) {
                renderChart(question.type, question.chartData);
            }
        }
        
        // Format question type for display
        function formatQuestionType(type) {
            const typeMap = {
                'multiple-choice': 'Multiple Choice',
                'true-false': 'True/False',
                'matching': 'Matching',
                'fill-blank': 'Fill in the Blank',
                'essay': 'Essay',
                'case-study': 'Case Study',
                'chart-radar': 'Radar Chart',
                'chart-pie': 'Pie Chart',
                'chart-line': 'Line Chart',
                'chart-bar': 'Bar Chart',
                'chart-doughnut': 'Doughnut Chart',
                'chart-polar': 'Polar Chart',
                'calculation': 'Calculation'
            };
            return typeMap[type] || type;
        }
        
        // Render chart for chart questions
        function renderChart(chartType, chartData) {
            // Destroy previous charts
            charts.forEach(chart => chart.destroy());
            charts = [];
            
            const ctx = document.getElementById('question-chart').getContext('2d');
            let newChart;
            
            const chartTypeMap = {
                'chart-radar': 'radar',
                'chart-pie': 'pie',
                'chart-line': 'line',
                'chart-bar': 'bar',
                'chart-doughnut': 'doughnut',
                'chart-polar': 'polarArea'
            };
            
            newChart = new Chart(ctx, {
                type: chartTypeMap[chartType],
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    scales: chartType === 'chart-radar' ? {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            pointLabels: {
                                font: {
                                    size: 10
                                }
                            }
                        }
                    } : {}
                }
            });
            
            charts.push(newChart);
        }
        
        // Update question navigation buttons
        function updateQuestionNavigation() {
            const buttons = questionGrid.querySelectorAll('.question-btn');
            const quiz = quizzes[currentQuiz];
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'answered', 'marked');
                
                if (index === currentQuestionIndex) {
                    btn.classList.add('active');
                }
                
                if (userAnswers[index] !== null) {
                    btn.classList.add('answered');
                }
                
                if (markedQuestions[index]) {
                    btn.classList.add('marked');
                }
            });
            
            // Update answered count
            answeredCount = userAnswers.filter(answer => answer !== null).length;
            answeredCountEl.textContent = `${answeredCount}/${quiz.questions.length}`;
        }
        
        // Select an answer
        function selectAnswer(answer) {
            userAnswers[currentQuestionIndex] = answer;
            updateQuestionNavigation();
            
            // For fill-blank and essay questions, we need to reload to update the selected state
            const question = quizzes[currentQuiz].questions[currentQuestionIndex];
            if (question.type === 'fill-blank' || question.type === 'essay' || question.type === 'calculation') {
                loadQuestion(currentQuestionIndex);
            }
        }
        
        // Update essay word count
        function updateEssayWordCount(index, textarea) {
            const answer = textarea.value;
            userAnswers[index] = answer;
            
            const wordCount = answer ? answer.split(/\s+/).filter(word => word.length > 0).length : 0;
            const wordCountEl = textarea.nextElementSibling;
            wordCountEl.textContent = `Words: ${wordCount} (Minimum: ${quizzes[currentQuiz].questions[index].minWords})`;
            
            updateQuestionNavigation();
        }
        
        // Toggle mark question
        function toggleMarkQuestion() {
            markedQuestions[currentQuestionIndex] = !markedQuestions[currentQuestionIndex];
            updateQuestionNavigation();
            loadQuestion(currentQuestionIndex); // Reload to update mark button text
        }
        
        // Drag and drop functions for matching questions
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function drop(ev, rightIndex) {
            ev.preventDefault();
            const leftId = ev.dataTransfer.getData("text");
            const leftIndex = parseInt(leftId.split('-')[1]);
            
            // Get the question
            const question = quizzes[currentQuiz].questions[currentQuestionIndex];
            
            // Initialize user answer if not already done
            if (!userAnswers[currentQuestionIndex]) {
                userAnswers[currentQuestionIndex] = [];
            }
            
            // Check if this left item is already matched
            const existingMatchIndex = userAnswers[currentQuestionIndex].findIndex(pair => pair[0] === leftIndex);
            
            if (existingMatchIndex >= 0) {
                // Remove existing match
                userAnswers[currentQuestionIndex].splice(existingMatchIndex, 1);
            }
            
            // Add new match
            userAnswers[currentQuestionIndex].push([leftIndex, rightIndex]);
            
            // Update the display
            loadQuestion(currentQuestionIndex);
        }
        
        // Remove a match
        function removeMatch(questionIndex, leftIndex, rightIndex) {
            const matchIndex = userAnswers[questionIndex].findIndex(
                pair => pair[0] === leftIndex && pair[1] === rightIndex
            );
            
            if (matchIndex >= 0) {
                userAnswers[questionIndex].splice(matchIndex, 1);
                loadQuestion(questionIndex);
            }
        }
        
        // Confirm before submitting quiz
        function confirmSubmit() {
            const unanswered = userAnswers.filter(answer => answer === null).length;
            
            if (unanswered > 0) {
                if (!confirm(`You have ${unanswered} unanswered questions. Are you sure you want to submit?`)) {
                    return;
                }
            } else {
                if (!confirm('Are you sure you want to submit your quiz?')) {
                    return;
                }
            }
            
            submitQuiz();
        }
        
        // Submit the quiz
        function submitQuiz() {
            clearInterval(timerInterval);
            quizStarted = false;
            
            // Calculate score
            let correctAnswers = 0;
            const quiz = quizzes[currentQuiz];
            
            quiz.questions.forEach((question, index) => {
                if (question.type === 'fill-blank' || question.type === 'calculation') {
                    if (userAnswers[index] && userAnswers[index].toString().toLowerCase() === question.correctAnswer.toLowerCase()) {
                        correctAnswers++;
                    }
                } else if (question.type === 'essay') {
                    // For essay questions, we'll just count them as answered
                    if (userAnswers[index]) {
                        correctAnswers++;
                    }
                } else if (question.type === 'matching') {
                    // For matching questions, check if all correct matches are present
                    if (userAnswers[index] && userAnswers[index].length === question.correctMatches.length) {
                        const allCorrect = question.correctMatches.every(correctPair => 
                            userAnswers[index].some(userPair => 
                                userPair[0] === correctPair[0] && userPair[1] === correctPair[1]
                            )
                        );
                        if (allCorrect) {
                            correctAnswers++;
                        }
                    }
                } else {
                    if (userAnswers[index] === question.correctAnswer) {
                        correctAnswers++;
                    }
                }
            });
            
            const score = Math.round((correctAnswers / quiz.questions.length) * 100);
            
            // Show results
            questionContent.innerHTML = `
                <div style="text-align: center; padding: 30px 15px;">
                    <h2 style="color: var(--primary-color); margin-bottom: 15px;">Quiz Submitted Successfully</h2>
                    <div style="font-size: 48px; color: var(--secondary-color); font-weight: bold; margin: 20px 0;">${score}%</div>
                    <p style="font-size: 16px; margin-bottom: 20px;">
                        You answered ${correctAnswers} out of ${quiz.questions.length} questions correctly.
                    </p>
                    
                    <div class="result-chart-container">
                        <canvas id="result-chart"></canvas>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 10px;">
                        <button class="btn btn-primary" onclick="reviewQuiz()">
                            <i class="fas fa-search"></i> Review Answers
                        </button>
                        <button class="btn btn-outline" onclick="returnToDashboard()">
                            <i class="fas fa-home"></i> Return to Dashboard
                        </button>
                    </div>
                </div>
            `;
            
            // Show result chart
            const ctx = document.getElementById('result-chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect', 'Unanswered'],
                    datasets: [{
                        data: [
                            correctAnswers,
                            userAnswers.filter(a => a !== null).length - correctAnswers,
                            userAnswers.filter(a => a === null).length
                        ],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.7)',
                            'rgba(244, 67, 54, 0.7)',
                            'rgba(158, 158, 158, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Review quiz answers
        function reviewQuiz() {
            currentQuestionIndex = 0;
            loadQuestion(currentQuestionIndex);
        }
        
        // Initialize the system when page loads
        window.onload = initQuizSystem;
    </script>
</body>
</html>